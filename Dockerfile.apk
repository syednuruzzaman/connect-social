# Use Android SDK image
FROM thyrlian/android-sdk:latest

# Set working directory
WORKDIR /app

# Install Node.js
RUN curl -fsSL https://deb.nodesource.com/setup_18.x | bash - \
    && apt-get install -y nodejs

# Copy project files
COPY . .

# Install dependencies
RUN npm install

# Build the mobile app
RUN cp next.mobile.config.js next.config.mjs && npm run build

# Sync with Capacitor
RUN npx cap sync android

# Build APK
WORKDIR /app/android
RUN chmod +x ./gradlew && ./gradlew assembleDebug assembleRelease

# Copy APKs to output directory
RUN mkdir -p /output && \
    cp app/build/outputs/apk/debug/app-debug.apk /output/ && \
    cp app/build/outputs/apk/release/app-release-unsigned.apk /output/

CMD ["echo", "APK build complete! Check /output directory"]
